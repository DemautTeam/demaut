<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings version="2.0"
	xmlns="http://java.sun.com/xml/ns/persistence/orm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm
				 http://java.sun.com/xml/ns/persistence/orm_2_0.xsd">

    <!-- - OpenJPA limitations / bugs : - Not working well with access="PROPERTY"
        - <enumerated>STRING not working well when used in a OneToMany - OneToMany
        + EAGER not working - OneToMany + LAZY => create null list (voir explication https://issues.apache.org/jira/browse/OPENJPA-2483) - Wrong warnings
        from OpenJPA "non-er - Access property ne marche pas
        - Enumarated as STRING does not work in many-2-one
	- BUG : Optimistic locking errors were detected when flushing to the data store
        - OpenJpaDialect does not support custom isolation levels due to limitations in standard JPA : @Transactional(isolation = Isolation.READ_COMMITTED)
        -->

    <persistence-unit-metadata>
        <persistence-unit-defaults>
            <access>FIELD</access>
        </persistence-unit-defaults>
    </persistence-unit-metadata>

    <!-- BASIC -->

    <mapped-superclass
            class="ch.vd.demaut.commons.entities.EntityFunctionalKeyAware">
        <attributes>
            <id name="id">
                <generated-value strategy="AUTO"/>
            </id>
            <version name="version"></version>
        </attributes>
    </mapped-superclass>

    <mapped-superclass
            class="ch.vd.demaut.commons.entities.AbstractEntity">
        <attributes>
            <id name="id">
                <generated-value strategy="AUTO"/>
            </id>
            <version name="version"></version>
        </attributes>
    </mapped-superclass>

    <mapped-superclass class="ch.vd.demaut.commons.vo.BaseValueObjectWithId">
        <attributes>
            <id name="id">
                <generated-value strategy="AUTO"/>
            </id>
        </attributes>
    </mapped-superclass>

    <!-- Cannot inherit for embeddable type. See http://stackoverflow.com/questions/29278249 -->
    <!-- 	<embeddable class="ch.vd.demaut.commons.vo.StringVO"> -->
    <!-- 		<attributes> -->
    <!-- 			<basic name="value"/> -->
    <!-- 		</attributes> -->
    <!-- 	</embeddable> -->

    <!-- Cannot use attribute-override inside embedded attribute even the doc say its OK -->
    <!--http://openjpa.apache.org/builds/1.2.3/apache-openjpa/docs/jpa_overview_mapping_field.html-->
    <!--<embedded name="telephonePrive">-->
        <!--<attribute-override name="value">-->
            <!--<column name="telephone_prive" column-definition="varchar" length="254"/>-->
        <!--</attribute-override>-->
    <!--</embedded>-->
    <!--<embedded name="telephoneMobile">-->
        <!--<attribute-override name="value">-->
            <!--<column name="telephone_mobile" column-definition="varchar" length="254"/>-->
        <!--</attribute-override>-->
    <!--</embedded>-->


    <!-- DEMANDE -->

    <entity class="ch.vd.demaut.domain.demandes.Demande">
        <table name="DEMANDE"/>
        <inheritance strategy="SINGLE_TABLE"/>
        <attributes>
            <embedded name="referenceDeDemande"/>
            <embedded name="dateDeCreation"/>
        </attributes>
    </entity>

    <entity class="ch.vd.demaut.domain.demandes.autorisation.DemandeAutorisation">
        <attributes>
            <basic name="profession">
                <column name="profession"/>
                <enumerated>STRING</enumerated>
            </basic>
            <basic name="statutDemandeAutorisation">
                <column name="statut_Demande"/>
                <enumerated>STRING</enumerated>
            </basic>
            <!-- On ne peut pas utiliser EAGER : https://issues.apache.org/jira/browse/OPENJPA-1908 -->
            <one-to-many name="annexes">
                <join-column/>
                <cascade>
                    <cascade-all/>
                </cascade>
            </one-to-many>
            <one-to-one name="donneesProfessionnelles">
                <cascade>
                    <cascade-all/>
                </cascade>
            </one-to-one>
            <one-to-one name="donneesPersonnelles">
                <cascade>
                    <cascade-all/>
                </cascade>
            </one-to-one>
            <embedded name="login"/>
        </attributes>
    </entity>

    <entity class="ch.vd.demaut.domain.utilisateurs.Utilisateur">
        <table name="UTILISATEUR"/>
        <attributes>
            <embedded name="login"/>
        </attributes>
    </entity>

    <!-- ANNEXE -->

    <entity class="ch.vd.demaut.domain.annexes.Annexe">
        <table name="ANNEXE"/>
        <attributes>
            <basic name="typeAnnexe">
                <column name="type_Annexe"/>
                <enumerated>ORDINAL</enumerated>
            </basic>
            <embedded name="nomFichier"/>
            <embedded name="contenu"/>
            <embedded name="dateDeCreation"/>
        </attributes>
    </entity>

    <!-- DONNEES PROFESSIONNELLES -->

    <entity class="ch.vd.demaut.domain.demandeur.donneesProf.DonneesProfessionnelles">
        <table name="DONNEES_PROFESSIONNELLES"/>
        <attributes>
            <!-- On ne peut pas utiliser EAGER : https://issues.apache.org/jira/browse/OPENJPA-1908 -->
            <one-to-many name="diplomes">
                <join-column/>
                <cascade>
                    <cascade-all/>
                </cascade>
            </one-to-many>
            <embedded name="codeGLN"/>
        </attributes>
    </entity>

    <entity class="ch.vd.demaut.domain.demandeur.donneesPerso.DonneesPersonnelles">
        <table name="DONNEES_PERSONNELLES"/>
        <attributes>
            <basic name="nationalite">
                <column name="nationalite"/>
                <enumerated>ORDINAL</enumerated>
            </basic>
            <basic name="langue">
                <column name="langue"/>
                <enumerated>ORDINAL</enumerated>
            </basic>
            <basic name="genre">
                <column name="genre"/>
                <enumerated>STRING</enumerated>
            </basic>
            <one-to-one name="adresse">
                <cascade>
                    <cascade-all/>
                </cascade>
            </one-to-one>
            <embedded name="nom"/>
            <embedded name="prenom"/>
            <embedded name="nomDeCelibataire"/>
            <embedded name="dateDeNaissance"/>
            <embedded name="email"/>
            <embedded name="telephonePrive"/>
            <embedded name="telephoneMobile"/>
            <embedded name="fax"/>
            <embedded name="permis"/>
        </attributes>
    </entity>

    <!-- DIPLOME -->

    <entity class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.Diplome">
        <table name="DIPLOME"/>
        <attributes>
            <basic name="typeDiplomeAccepte">
                <column name="type_Diplome_Accepte"/>
                <enumerated>STRING</enumerated>
            </basic>
            <basic name="complement">
                <column name="complement" column-definition="varchar" length="254"/>
            </basic>
            <embedded name="referenceDeDiplome"/>
            <embedded name="titreFormation"/>
            <embedded name="dateObtention"/>
            <embedded name="paysObtention"/>
            <embedded name="dateReconnaissance"/>
        </attributes>
    </entity>

    <!-- ADRESSE -->

    <entity class="ch.vd.demaut.domain.demandeur.donneesPerso.Adresse">
        <table name="ADRESSE_PERSONNELLE"/>
        <attributes>
            <basic name="pays">
                <column name="pays"/>
                <enumerated>ORDINAL</enumerated>
            </basic>
            <basic name="voie">
                <column name="voie" column-definition="varchar" length="254"/>
            </basic>
            <basic name="complement">
                <column name="complement" column-definition="varchar" length="254"/>
            </basic>
            <embedded name="npa"/>
            <embedded name="localite"/>
        </attributes>
    </entity>

    <!-- EMBEDDABLE -->

    <embeddable class="ch.vd.demaut.domain.annexes.NomFichier">
        <attributes>
            <basic name="nomFichier">
                <column name="nom_fichier" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.annexes.ContenuAnnexe">
        <attributes>
            <basic name="contenu">
                <column name="contenu"/>
                <lob/>
            </basic>
            <basic name="taille"/>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.utilisateurs.Login">
        <attributes>
            <basic name="value">
                <column name="login" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandes.ReferenceDeDemande">
        <attributes>
            <basic name="value">
                <column name="reference_Demande" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.CodeGLN">
        <attributes>
            <basic name="value">
                <column name="code_GLN" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.TitreFormation">
        <attributes>
            <basic name="value">
                <column name="titre_Formation" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.DateObtention">
        <attributes>
            <basic name="value">
                <column name="date_Obtention" column-definition="date"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.PaysObtention">
        <attributes>
            <basic name="value">
                <column name="pays_Obtention"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.DateReconnaissance">
        <attributes>
            <basic name="value">
                <column name="date_Reconnaissance" column-definition="date"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandes.DateDeCreation">
        <attributes>
            <basic name="value">
                <column name="date_Creation" column-definition="date"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.ReferenceDeDiplome">
        <attributes>
            <basic name="value">
                <column name="reference_Diplome" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.NPA">
        <attributes>
            <basic name="value">
                <column name="npa" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.Localite">
        <attributes>
            <basic name="value">
                <column name="localite" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.Nom">
        <attributes>
            <basic name="value">
                <column name="nom" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.Prenom">
        <attributes>
            <basic name="value">
                <column name="prenom" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.NomDeCelibataire">
        <attributes>
            <basic name="value">
                <column name="nom_de_Celibataire" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.DateDeNaissance">
        <attributes>
            <basic name="value">
                <column name="date_de_Naissance" column-definition="date"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.Email">
        <attributes>
            <basic name="value">
                <column name="email" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.NumeroTelephone">
        <attributes>
            <basic name="value">
                <column name="telephone" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.TelephonePrive">
        <attributes>
            <basic name="value">
                <column name="telephone_prive" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.TelephoneMobile">
        <attributes>
            <basic name="value">
                <column name="telephone_mobile" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.Fax">
        <attributes>
            <basic name="value">
                <column name="fax" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.Permis">
        <attributes>
            <basic name="typePermis">
                <column name="type_permis"/>
                <enumerated>STRING</enumerated>
            </basic>
            <embedded name="autrePermis"/>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesPerso.AutrePermis">
        <attributes>
            <basic name="value">
                <column name="autre_permis" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

</entity-mappings>
