<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings version="2.0"
	xmlns="http://java.sun.com/xml/ns/persistence/orm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm
				 http://java.sun.com/xml/ns/persistence/orm_2_0.xsd">

    <!-- - OpenJPA limitations / bugs : - Not working well with access="PROPERTY"
        - <enumerated>STRING not working well when used in a OneToMany - OneToMany
        + EAGER not working - OneToMany + LAZY => create null list (voir explication https://issues.apache.org/jira/browse/OPENJPA-2483) - Wrong warnings
        from OpenJPA "non-er - Access property ne marche pas
        - Enumarated as STRING does not work in many-2-one

        -->

    <persistence-unit-metadata>
        <persistence-unit-defaults>
            <access>FIELD</access>
        </persistence-unit-defaults>
    </persistence-unit-metadata>

    <!-- BASIC -->

    <mapped-superclass
            class="ch.vd.demaut.commons.entities.EntityFunctionalKeyAware">
        <attributes>
            <id name="id">
                <generated-value strategy="AUTO"/>
            </id>
            <version name="version"></version>
        </attributes>
    </mapped-superclass>

    <mapped-superclass
            class="ch.vd.demaut.commons.entities.AbstractEntity">
        <attributes>
            <id name="id">
                <generated-value strategy="AUTO"/>
            </id>
            <version name="version"></version>
        </attributes>
    </mapped-superclass>

    <mapped-superclass class="ch.vd.demaut.commons.vo.BaseValueObjectWithId">
        <attributes>
            <id name="id">
                <generated-value strategy="AUTO"/>
            </id>
        </attributes>
    </mapped-superclass>

    <!-- Cannot inherit for embeddable type. See http://stackoverflow.com/questions/29278249 -->
    <!-- 	<embeddable class="ch.vd.demaut.commons.vo.StringVO"> -->
    <!-- 		<attributes> -->
    <!-- 			<basic name="value"/> -->
    <!-- 		</attributes> -->
    <!-- 	</embeddable> -->

    <!-- DEMANDE -->

    <entity class="ch.vd.demaut.domain.demandes.Demande">
        <table name="DEMANDE"/>
        <inheritance strategy="SINGLE_TABLE"/>
        <attributes>
            <embedded name="referenceDeDemande"/>
            <embedded name="dateDeCreation"/>
        </attributes>
    </entity>

    <entity class="ch.vd.demaut.domain.demandes.autorisation.DemandeAutorisation">
        <attributes>
            <basic name="profession">
                <column name="profession"/>
                <enumerated>STRING</enumerated>
            </basic>
            <basic name="statutDemandeAutorisation">
                <column name="statut_Demande"/>
                <enumerated>STRING</enumerated>
            </basic>
            <!-- On ne peut pas utiliser EAGER : https://issues.apache.org/jira/browse/OPENJPA-1908 -->
            <one-to-many name="annexes" fetch="LAZY">
                <join-column/>
                <cascade>
                    <cascade-all/>
                </cascade>
            </one-to-many>
            <one-to-one name="donneesProfessionnelles" fetch="LAZY">
                <cascade>
                    <cascade-all/>
                </cascade>
            </one-to-one>
            <embedded name="login"/>
        </attributes>
    </entity>

    <entity class="ch.vd.demaut.domain.utilisateurs.Utilisateur">
        <table name="UTILISATEUR"/>
        <attributes>
            <embedded name="login"/>
        </attributes>
    </entity>

    <!-- ANNEXE -->

    <entity class="ch.vd.demaut.domain.annexes.Annexe">
        <attributes>
            <basic name="typeAnnexe">
                <column name="type_Annexe"/>
                <enumerated>ORDINAL</enumerated>
            </basic>
            <embedded name="nomFichier"/>
            <embedded name="contenu"/>
            <embedded name="dateDeCreation"/>
        </attributes>
    </entity>

    <!-- DONNEES PROFESSIONNELLES -->

    <entity class="ch.vd.demaut.domain.demandeur.donneesProf.DonneesProfessionnelles">
        <table name="DONNEES_PROFESSIONNELLES"/>
        <attributes>
            <!-- On ne peut pas utiliser EAGER : https://issues.apache.org/jira/browse/OPENJPA-1908 -->
            <one-to-many name="diplomes" fetch="LAZY">
                <join-column/>
                <cascade>
                    <cascade-all/>
                </cascade>
            </one-to-many>
            <embedded name="codeGLN"/>
        </attributes>
    </entity>

    <!-- DIPLOME -->

    <entity class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.Diplome">
        <attributes>
            <basic name="typeDiplomeAccepte">
                <column name="type_Diplome_Accepte"/>
                <enumerated>STRING</enumerated>
            </basic>
            <basic name="complement" access="PROPERTY">
                <column name="complement" column-definition="varchar" length="254"/>
            </basic>
            <embedded name="referenceDeDiplome"/>
            <embedded name="titreFormation"/>
            <embedded name="dateObtention"/>
            <embedded name="paysObtention"/>
            <embedded name="dateReconnaissance"/>
        </attributes>
    </entity>

    <!-- EMBEDDABLE -->

    <embeddable class="ch.vd.demaut.domain.annexes.NomFichier">
        <attributes>
            <basic name="nomFichier" access="PROPERTY">
                <column name="nom_fichier" column-definition="varchar" length="254"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.annexes.ContenuAnnexe">
        <attributes>
            <basic name="contenu" access="PROPERTY">
                <column name="contenu"/>
                <lob/>
            </basic>
            <basic name="taille" access="PROPERTY"/>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.utilisateurs.Login">
        <attributes>
            <basic name="value" access="PROPERTY">
                <column name="login"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandes.ReferenceDeDemande">
        <attributes>
            <basic name="value">
                <column name="reference_Demande"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.CodeGLN">
        <attributes>
            <basic name="value">
                <column name="code_GLN"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.TitreFormation">
        <attributes>
            <basic name="value">
                <column name="titre_Formation"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.DateObtention">
        <attributes>
            <basic name="value">
                <column name="date_Obtention" column-definition="date"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.PaysObtention">
        <attributes>
            <basic name="value">
                <column name="pays_Obtention"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.DateReconnaissance">
        <attributes>
            <basic name="value">
                <column name="date_Reconnaissance" column-definition="date"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandes.DateDeCreation">
        <attributes>
            <basic name="value">
                <column name="date_Creation" column-definition="date"/>
            </basic>
        </attributes>
    </embeddable>

    <embeddable class="ch.vd.demaut.domain.demandeur.donneesProf.diplome.ReferenceDeDiplome">
        <attributes>
            <basic name="value">
                <column name="reference_Diplome"/>
            </basic>
        </attributes>
    </embeddable>

</entity-mappings>
