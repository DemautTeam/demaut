<div ng-include="'template/include/include-titre.html'"></div>
<div ng-include="'template/include/include-steps.html'"></div>

<div class="bs-wizard-info text-left">
    <div class="row">
        <br/>
    </div>
        <legend>Veuillez saisir vos titres et formations :</legend>
        <div>
            <ng-form name="donneesDiplome.diplomeDataForm">
                <!--TODO remplacer ce message??-->
                <div id="Edit_warning" class="alert alert-warning" ng-show="wouldEditDiplome">
                    <button type="button" class="close" data-target="#Edit_warning" data-dismiss="alert">
                        <span aria-hidden="true">&times;</span><span class="sr-only">×</span>
                    </button>
                    Le diplôme selectionné en modification a été supprimé en base.
                </div>

                <!--Données de diplomes-->
                <fieldset>
                    <div class="row">
                        <div class="col-md-2"><label>Formation</label></div>
                    </div><div class="row"></br></div>
                    <!--Type de diplome-->
                    <div class="row form-group" ng-class="{ 'has-error' : (wouldStepNext && donneesDiplome.diplomeDataForm.typeDiplome.$invalid ) || (donneesDiplome.diplomeDataForm.typeDiplome.$invalid && !donneesDiplome.diplomeDataForm.typeDiplome.$pristine)}">
                        <div class="col-md-2"><label for="typeDiplome">Type de diplôme*</label></div>
                        <div class="col-md-6" popover-enable="(wouldStepNext && donneesDiplome.diplomeDataForm.typeDiplome.$invalid ) || (donneesDiplome.diplomeDataForm.typeDiplome.$invalid && !donneesDiplome.diplomeDataForm.typeDiplome.$pristine)"
                             popover-trigger="none" popover-is-open="wouldStepNext && donneesDiplome.diplomeDataForm.typeDiplome.$invalid" popover-placement="right"
                             uib-popover="Veuillez selectionner un type de diplôme.">
                            <select id="typeDiplome" name="typeDiplome" ng-model="diplomeData.diplome.typeDiplome" ng-change="fetchListeFormations()" required class="form-control"
                                ng-options="typeDiplome.libl for typeDiplome in typeDiplomes track by typeDiplome.id"></select>
                        </div>
                    </div>
                    <!--Titre de la formation-->
                    <div class="row form-group" ng-class="{ 'has-error' : (wouldStepNext && donneesDiplome.diplomeDataForm.typeFormation.$invalid ) || (donneesDiplome.diplomeDataForm.typeFormation.$invalid && !donneesDiplome.diplomeDataForm.typeFormation.$pristine)}">
                        <div class="col-md-2"><label for="typeFormation">Titre de la formation*</label></div>
                        <div class="col-md-6" popover-enable="(wouldStepNext && donneesDiplome.diplomeDataForm.typeFormation.$invalid ) || (donneesDiplome.diplomeDataForm.typeFormation.$invalid && !donneesDiplome.diplomeDataForm.typeFormation.$pristine)"
                             popover-trigger="none" popover-is-open="wouldStepNext && donneesDiplome.diplomeDataForm.typeFormation.$invalid" popover-placement="right"
                             uib-popover="Veuillez selectionner un titre de formation.">
                            <select id="typeFormation" name="typeFormation" ng-model="diplomeData.diplome.typeFormation" required class="form-control"
                                    ng-options="typeFormation.libl for typeFormation in typeFormations track by typeFormation.id"></select>
                        </div>
                    </div>
                    <!--Complément-->
                    <div class="row form-group">
                        <div class="col-md-2"><label for="complement">Complément</label></div>
                        <div class="col-md-6">
                            <input type="text" id="complement" name="complement" class="form-control" ng-model="personalData.diplome.complement">
                        </div>
                    </div>
                    <!--Date d'obtention-->
                    <div class="row form-group" ng-class="{ 'has-error' : (wouldStepNext && donneesDiplome.diplomeDataForm.dateObtention.$invalid ) || (donneesDiplome.diplomeDataForm.dateObtention.$invalid && !donneesDiplome.diplomeDataForm.dateObtention.$pristine)}">
                       <div class="col-md-2"><label for="dateObtention">Date d'obtention*</label></div>
                        <div class="col-md-2" popover-enable="(wouldStepNext && donneesDiplome.diplomeDataForm.dateObtention.$invalid ) || (donneesDiplome.diplomeDataForm.dateObtention.$invalid && !donneesDiplome.diplomeDataForm.dateObtention.$pristine)"
                             popover-trigger="none" popover-is-open="wouldStepNext && donneesDiplome.diplomeDataForm.dateObtention.$invalid" popover-placement="right"
                             uib-popover="Veuillez saisir une date d'obtention du diplôme.">
                            <p class="input-group">
                                <input type="text" class="form-control" id="dateObtention" name="dateObtention" placeholder="{{datePicker.placeholder}}"
                                       datepicker-popup="{{datePicker.format}}" ng-model="diplomeData.diplome.dateObtention" class="form-control"
                                       is-open="diplomeData.datePicker.status.dateObtention.opened" max-date="datePicker.maxDate" datepicker-options="datePicker.dateOptions"
                                       required close-text="Fermer" clear-text="Effacer" current-text="aujourd'hui"/>
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-click="openDatePicker(diplomeData.datePicker.status.dateObtention)">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </button>
                                </span>
                            </p>
                        </div>
                    </div>
                    <!--Pays d'obtention-->
                    <div class="row form-group" ng-class="{ 'has-error' : (wouldStepNext && donneesDiplome.diplomeDataForm.diplome.paysOlbtention.$invalid ) || (donneesDiplome.diplomeDataForm.paysObtention.$invalid && !donneesDiplome.diplomeDataForm.paysObtention.$pristine)}">
                        <div class="col-md-2"><label for="paysObtention">Pays d'obtention*</label></div>
                        <div class="col-md-4" popover-enable="(wouldStepNext && donneesDiplome.diplomeDataForm.paysObtention.$invalid ) || (donneesDiplome.diplomeDataForm.paysObtention.$invalid && !donneesDiplome.diplomeDataForm.paysObtention.$pristine)"
                             popover-trigger="none" popover-is-open="wouldStepNext && donneesDiplome.diplomeDataForm.paysObtention.$invalid" popover-placement="right"
                             uib-popover="Veuillez saisir le pays d'obtention du diplôme.">
                            <select id="paysObtention" name="paysObtention" ng-model="diplomeData.diplome.paysObtention" required class="form-control"
                                    ng-options="pays.libl for pays in paysList track by pays.id"/>
                        </div>
                    </div>
                    <!--Date de réconnaissance-->
                    <div class="row">
                        <label for="dateReconnaissance" class="col-md-2">Date de reconnaissance</label>
                        <div class="col-md-2">
                            <p class="input-group">
                                <input type="text" class="form-control" id="dateReconnaissance" name="dateReconnaissance" placeholder="{{datePicker.placeholder}}"
                                       datepicker-popup="{{datePicker.format}}" ng-model="diplomeData.diplome.dateReconnaissance"
                                       is-open="diplomeData.datePicker.status.dateReconnaissance.opened" max-date="datePicker.maxDate" datepicker-options="datePicker.dateOptions"
                                       ng-required="isDateReconnaissanceRequired()" close-text="Fermer" clear-text="Effacer" current-text="Aujourd'hui"/>
                                <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-click="openDatePicker(diplomeData.datePicker.status.dateReconnaissance)">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </button>
                                </span>
                            </p>
                        </div>
                    </div>
                </fieldset>
                
            </ng-form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary submit-btn" type="submit" aria-label="Nouvelle" ng-click="addAnotherDiplome()">
                <span class="glyphicon glyphicon-plus"></span>
                Ajouter une formation
            </button>
        </div>
        <div ng-show="diplomeData.diplomes.length > 0">
            <legend>Formations et titres :</legend>
            <div style="overflow: auto;">
                <table class="table table-striped">
                    <thead>
                    <tr bgcolor="#99CC00">
                        <th>Type de diplôme</th>
                        <th>Titre de la formation</th>
                        <th>Date d'obtention</th>
                        <th>Pays d'obtention</th>
                        <th>Date de reconnaissance</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tr ng-repeat="diplome in diplomeData.diplomes | orderBy:'-dateObtention'">
                        <td>{{diplome.typeDiplome.libl}}</td>
                        <td>
                            {{diplome.typeFormation.libl}}
                        </td>
                        <td>
                            {{diplome.dateObtention | date:'dd.MM.yyyy'}}
                        </td>
                        <td>
                            {{diplome.paysObtention.libl}}
                        </td>
                        <td>
                            {{diplome.dateReconnaissance | date:'dd.MM.yyyy'}}
                        </td>
                        <td>
                            <a href="" ng-click="editDiplome(diplome)" class="btn btn-xs btn-default">
                                <span class="glyphicon glyphicon-edit"></span>
                            </a>
                            <a href="" ng-click="deleteDiplome(diplome)" class="btn btn-xs btn-default">
                                <span class="glyphicon glyphicon-trash"></span>
                            </a>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
</div>
<step-actions back-step-fn="backStep()" next-step-fn="nextStep()"/>